function LimpiarForm(){$("#hdIdPrimary").val("0"),$("#ddlInstructor").val("0"),$("#ddlDia").val("02"),$("#txtHoraInicio").val("07:00"),$("#txtHoraFinal").val("08:00"),$("#txtAforo").val("0"),$("#txtminutos").val("30"),$("#ddlRutinaGrupal").val("0").focus()}function MostrarDatos(){$.ajax({url:"services/horariogrupal/horariogrupal-search.php",type:"GET",dataType:"json",data:{tipobusqueda:"1",idempresa:$("#hdIdEmpresa").val(),idcentro:$("#hdIdCentro").val(),criterio:""},success:function(a){var t=0,o=a.length,r="";if(o>0)for(;t<o;)r+='<li class="mdl-list__item dato pos-rel" data-id="'+a[t].td_idhorariogrupal+'">',r+='<input name="chkItem[]" type="checkbox" class="oculto" value="'+a[t].td_idhorariogrupal+'" />',r+='<span class="mdl-list__item-primary-content"> DÍA:'+a[t].dia+"  RUTINA:"+a[t].rutina+"  INICIO:"+a[t].tm_hora_inicio+" FINAL:"+a[t].tm_hora_final+" INSTRUCTOR:"+a[t].instructor+"</span>",r+='<div class="grouped-buttons place-bottom-right padding5 margin5"><a class="padding5 mdl-button mdl-button--icon tooltipped" href="#" data-action="edit" data-delay="50" data-position="bottom" data-tooltip="Editar"><i class="material-icons">&#xE254;</i></a><a class="padding5 mdl-button mdl-button--icon tooltipped" href="#" data-action="delete" data-delay="50" data-position="bottom" data-tooltip="Eliminar"><i class="material-icons">&#xE872;</i></a></div>',r+="</li>",++t;else r="<h2>No se encontraron resultados.</h2>";$("#gvDatos").html(r)},error:function(a){console.log(a)}})}function GuardarDatos(){if(validHoraClase()){var a=new FormData,t=$("#modalRegistro :input").serializeArray();a.append("btnGuardar","btnGuardar"),Array.prototype.forEach.call(t,function(t){a.append(t.name,t.value)}),$.ajax({type:"POST",url:"services/horariogrupal/horariogrupal-post.php",cache:!1,contentType:!1,processData:!1,data:a,dataType:"json",success:function(a){createSnackbar(a.titulomsje),"0"!=a.rpta&&(closeCustomModal("#modalRegistro"),MostrarDatos())},error:function(a){console.log(a)}})}}function GetDataById(a){LimpiarForm(),openModalCallBack("#modalRegistro",function(){"0"==a?(ListarRutinagrupal_Combo("0"),ListarInstructor_Combo("0"),$("#ddlRutinaGrupal").focus(),precargaExp(selectorModal,!1)):$.ajax({url:"services/horariogrupal/horariogrupal-search.php",type:"GET",dataType:"json",data:{tipobusqueda:"5",id:a},success:function(a){a.length>0&&($("#hdIdPrimary").val(a[0].td_idhorariogrupal),$("#ddlDia").val(a[0].ta_diasemana),$("#txtHoraInicio").val(a[0].tm_hora_inicio),$("#txtHoraFinal").val(a[0].tm_hora_final),$("#txtAforo").val(a[0].tm_aforo),$("#txtminutos").val(a[0].tm_minutos_sep),ListarRutinagrupal_Combo(a[0].tm_idrutinagrupal),ListarInstructor_Combo(a[0].tm_idinstructorgrupal),$("#ddlRutinaGrupal").val(a[0].tm_idrutinagrupal).focus(),Materialize.updateTextFields())},error:function(a){console.log(a)}})})}function EliminarItem(a,t){var o=new FormData,r=a.getAttribute("data-id");o.append("btnEliminar","btnEliminar"),o.append("hdIdPrimary",r),$.ajax({type:"POST",url:"services/horariogrupal/horariogrupal-post.php",cache:!1,contentType:!1,processData:!1,dataType:"json",data:o,success:function(o){var r="",e=!1;"0"==o.rpta?(e=!0,r="No se puede eliminar"):($(a).fadeOut(400,function(){$(this).remove(),0==$("#gvDatos .dato").length&&$("#gvDatos .gridview").html("<h2>No se encontraron registros</h2>")}),"multiple"==t?(++indexList,indexList<=elemsSelected.length-1?EliminarItem(elemsSelected[indexList],t):(e=!0,r=o.titulomsje)):"single"==t&&(e=!0,r=o.titulomsje)),e&&(createSnackbar(r),$(".actionbar").hasClass("is-visible")&&$(".back-button").trigger("click"))},error:function(a){console.log(a)}})}function ListarInstructor_Combo(a){$.ajax({type:"GET",url:"services/instructorgrupal/instructorgrupal-search.php",cache:!1,dataType:"json",data:{tipobusqueda:"1",idempresa:$("#hdIdEmpresa").val(),idcentro:$("#hdIdCentro").val()},success:function(t){var o="",r=t.length,e=0;if(r>0)for(;e<r;){var i=a==t[e].tm_idinstructorgrupal?" selected":"";o+="<option"+i+' value="'+t[e].tm_idinstructorgrupal+'">'+t[e].instructor+"</option>",++e}$("#ddlInstructor").html(o)},error:function(a){console.log(a)}})}function ListarRutinagrupal_Combo(a){$.ajax({type:"GET",url:"services/rutinagrupal/rutinagrupal-search.php",cache:!1,dataType:"json",data:{tipobusqueda:"1",idempresa:$("#hdIdEmpresa").val(),idcentro:$("#hdIdCentro").val()},success:function(t){var o="",r=t.length,e=0;if(r>0)for(;e<r;){var i=a==t[e].tm_idrutinagrupal?" selected":"";o+="<option"+i+' value="'+t[e].tm_idrutinagrupal+'">'+t[e].tm_nombre+"</option>",++e}$("#ddlRutinaGrupal").html(o)},error:function(a){console.log(a)}})}function validHoraClase(){var a=$("#txtHoraInicio").val(),t=$("#txtHoraFinal").val(),o=moment(t,"HH:mm:ss").diff(moment(a,"HH:mm:ss")),r=moment.duration(o),e=r.asMinutes();return e>0?e<45?(alert("La clase tiene que durar al menos 45 minutos."),!1):!(e>60)||(alert("La clase no puede durar más de una hora."),!1):0==e?(alert("La hora de inicio y la hora final no pueden ser iguales."),!1):(alert("La hora de inicio no puede ser mayor a la hora final."),!1)}$(function(){$(".timepicker").pickatime({"default":"now",fromnow:0,twelvehour:!1,donetext:"OK",cleartext:"Clear",canceltext:"Cancel",autoclose:!1,ampmclickable:!0,aftershow:function(){}}),$("#gvDatos").on("click",".mdl-button",function(a){a.preventDefault();var t=this.getAttribute("data-action"),o=getParentsUntil(this,"#gvDatos",".dato");if("edit"==t){var r=o[0].getAttribute("data-id");GetDataById(r)}else MessageBox({content:"¿Desea eliminar el tipo de ambiente?",width:"320px",height:"130px",buttons:[{primary:!0,content:"Eliminar",onClickButton:function(a){EliminarItem(o[0],"single")}}],cancelButton:!0})}),$("#btnNuevo").on("click",function(a){a.preventDefault(),GetDataById("0")}),$("#btnGuardar").on("click",function(a){a.preventDefault(),GuardarDatos()}),$("#btnLimpiar").on("click",function(a){a.preventDefault(),LimpiarForm()}),$("#txtNombre").on("keydown",function(a){if(a.keyCode==$.ui.keyCode.ENTER)return!1}),MostrarDatos()});