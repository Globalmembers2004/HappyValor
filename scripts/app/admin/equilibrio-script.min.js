function LimpiarForm(){$("#txtServicios").val("0.00"),$("#txtSueldos").val("0.00"),$("#txtotros").val("0.00"),$("#txttotal").val("0.00"),$("#txtutilidad").val("0.00"),$("#txtmeta").val("0.00"),Materialize.updateTextFields()}function GoToEdit(t){var e="#pnlForm";document.getElementById("hdIdPrimary").value="0",precargaExp(e,!0),LimpiarForm(),openModalCallBack(e,function(){"0"==t?($("#ddlmes").focus(),precargaExp(e,!1)):$.ajax({type:"GET",url:"services/equilibrio/equilibrio-getdetails.php",cache:!1,dataType:"json",data:"id="+t,success:function(t){t.length>0&&($("#hdIdPrimary").val(t[0].tm_idequilibrio),$("#ddlanno").val(t[0].ta_anno),$("#txtServicios").val(t[0].tm_servicios),$("#txtSueldos").val(t[0].tm_sueldos),$("#txtotros").val(t[0].tm_otros),$("#txttotal").val(t[0].tm_total),$("#txtutilidad").val(t[0].tm_utilidad),$("#ddlmes").val(t[0].ta_mes).focus(),Materialize.updateTextFields()),precargaExp(e,!1)},error:function(t){console.log(t)}})})}function BuscarDatos(t){var e="#gvDatos",a=e+" .gridview-content";precargaExp("#pnlListado",!0),$.ajax({type:"GET",url:"services/equilibrio/equilibrio-search.php",cache:!1,dataType:"json",data:{criterio:$("#txtSearch").val(),idempresa:$("#hdIdEmpresa").val(),idcentro:$("#hdIdCentro").val(),pagina:t},success:function(i){var o=i.length,l=0,n="";if(o>0){for(;l<o;){var r=i[l].tm_idequilibrio;n+='<li class="collection-item avatar no-border dato" data-idmodel="'+r+'"  data-baselement="'+e+'">',n+='<input name="chkItem[]" type="checkbox" class="oculto" value="'+r+'" />',n+='<i class="icon-select material-icons circle white-text">done</i><div class="layer-select"></div>',n+='<span class="title Mes" > Periodo: '+i[l].periodo+"    - Meta Mensual : "+i[l].tm_meta+"  - Utilidad Neta S/- : "+i[l].ganancia+" </span>",n+='<p>Servicios: <span class="Servicios">'+i[l].tm_servicios+'  Sueldos: <span class="servicios">'+i[l].tm_sueldos+'  Otros gastos: <span class="sueldos">'+i[l].tm_otros+'  TOTAL GASTOS: <span class="sueldos">'+i[l].tm_total+"</span><br>",n+='<p>Utilidad: <span class="Utilidad Planificada">'+i[l].tm_utilidad+"%</span><br>",n+='<div class="grouped-buttons place-top-right padding5">',n+='<a class="padding5 mdl-button mdl-button--icon tooltipped" href="#" data-action="more" data-delay="50" data-position="bottom" data-tooltip="M&aacute;s"><i class="material-icons md-18">&#xE5D4;</i></a>',n+='<ul class="dropdown"><li><a href="#" data-action="edit" class="waves-effect">Editar</a></li><li><a href="#" data-action="delete" class="waves-effect">Eliminar</a></li></ul>',n+="</div>",n+='<div class="divider"></div>',n+="</li>",++l}datagrid.currentPage(datagrid.currentPage()+1),"1"==t?$(a).html(n):$(a).append(n)}else"1"==t&&$(a).html("<h2>No se encontraron resultados.</h2>");precargaExp("#pnlListado",!1)},error:function(t){console.log(t)}})}function GuardarDatos(){var t=new FormData;precargaExp("#pnlForm",!0),t.append("btnGuardar","btnGuardar"),t.append("hdIdEmpresa",$("#hdIdEmpresa").val()),t.append("hdIdCentro",$("#hdIdCentro").val());var e=$("#pnlForm :input").serializeArray();Array.prototype.forEach.call(e,function(e){t.append(e.name,e.value)}),$.ajax({type:"POST",url:"services/equilibrio/equilibrio-post.php",contentType:!1,processData:!1,cache:!1,data:t,dataType:"json",success:function(t){precargaExp("#pnlForm",!1),createSnackbar(t.titulomsje),Number(t.rpta)>0&&(closeCustomModal("#pnlForm"),paginaGeneral=1,BuscarDatos("1"))},error:function(t){console.log(t)}})}function Eliminarequilibrio(){indexList=0,elemsSelected=$("#gvDatos .selected"),EliminarItemequilibrio(elemsSelected[0],"multiple")}function EliminarItemequilibrio(t,e){var a=new FormData,i=t.getAttribute("data-idmodel");a.append("btnEliminar","btnEliminar"),a.append("hdIdequilibrio",i),$.ajax({url:"services/equilibrio/equilibrio-post.php",type:"POST",dataType:"json",data:a,cache:!1,contentType:!1,processData:!1,success:function(a){var i="",o=!1;"0"==a.rpta?(o=!0,i="No se puede eliminar"):($(t).fadeOut(400,function(){$(this).remove()}),"multiple"==e?(++indexList,indexList<=elemsSelected.length-1?EliminarItemequilibrio(elemsSelected[indexList],e):(o=!0,i=a.titulomsje)):"single"==e&&(o=!0,i=a.titulomsje)),o&&(createSnackbar(i),$(".actionbar").hasClass("is-visible")&&$(".back-button").trigger("click"))},error:function(t){console.log(t)}})}function Buscar(){BuscarDatos("1")}function LimpiarFormDetalle(){$("#ddlTipoDetalle")[0].selectedIndex=0,$("#txtImporte").val("0.00"),$("#txtObservacion_Detalle").val("")}function addItemDetalle(t){var e="",a=t.td_idequilibrio,i=t.ta_tipo_servicio,o=t.tm_nombre,l=t.tm_total;return e+='<tr data-iditem="'+a+'" class="dato" data-tiposervicio="'+i+'">',e+='<td class="hide">',e+='<input name="itemdetalle['+filaItem+'][iddetalle]" type="hidden" id="iddetalle'+filaItem+'" value="'+a+'" />',e+='<input name="itemdetalle['+filaItem+'][codtiposervicio]" type="hidden" id="codtiposervicio'+filaItem+'" value="'+i+'" />',e+='<input name="itemdetalle['+filaItem+'][idcliente]" type="hidden" id="idcliente'+filaItem+'" value="'+t.tm_idcliente+'" />',e+='<input name="itemdetalle['+filaItem+'][nombre]" type="hidden" id="nombre'+filaItem+'" value="'+o+'" />',e+='<input name="itemdetalle['+filaItem+'][total]" type="hidden" id="total'+filaItem+'" value="'+l+'" />',e+='<td data-title="Tipo de detalle" class="v-align-middle nombre-articulo">'+t.tiposervicio+"</td>",e+='<td data-title="Detalle">'+o+"</td>",e+='<td data-title="Importe" class="text-right">'+l+"</td>",e+='<td><a class="padding5 mdl-button mdl-button--icon tooltipped center-block" href="#" data-action="delete" data-placement="left" data-toggle="tooltip" title="Eliminar"><i class="material-icons">&#xE872;</i></a></td>',e+="</tr>",++filaItem,e}function calcularSuma(){var t=0,e=0,a=0,i=document.querySelectorAll("#gvEvaluacion tbody tr"),o=i.length,l=0;if(o>0)for(;l<o;){var n=i[l].getAttribute("data-tiposervicio"),r=Number(i[l].querySelector('td[data-title="Importe"]').textContent);"01"==n?t+=r:"01"==n?e+=r:"02"==n&&(a+=r),++l}$("#txtServicios").val(t.toFixed(2)),$("#txtSueldos").val(e.toFixed(2)),$("#txtotros").val(a.toFixed(2))}function ListarSeguimiento(){$.ajax({url:"services/seguimiento/seguimiento-reporte.php",type:"GET",dataType:"json",data:{idempresa:$("#hdIdEmpresa").val(),idcentro:$("#hdIdCentro").val(),anho:$("#ddlAnhoSeguimiento").val(),mes_inicial:$("#ddlMesInicialSeguimiento").val(),mes_final:$("#ddlMesFinalSeguimiento").val()},success:function(t){var e=t.length,a=0,i="",o="",l="",n="",r="";if(e>0){for(i+="<thead><tr>",a=0;a<e;)i+="<th>"+t[a].mes+"</th>",++a;i+="</tr></thead>",o+="<tbody><tr>",l+='{ type: "column", name: "Metas", showInLegend: true, xValueFormatString: "MMMM YYYY", yValueFormatString: "#,##0.#", dataPoints: [';var d=[];for(a=0;a<e;){l+="{ x: new Date("+t[a].anho+", "+(Number(t[a].ta_mes)-1)+"), y: "+Number(t[a].tm_meta).toFixed(2)+" },",o+="<td>"+Number(t[a].tm_meta).toFixed(2)+"</td>";var s={x:new Date(t[a].anho,Number(t[a].ta_mes)-1),y:Number(t[a].tm_meta)};d.push(s),++a}l=l.substr(0,l.length-1),l+="]},",o+="</tr><tr>",n+='{ type: "column", name: "Ingresos", showInLegend: true, xValueFormatString: "MMMM YYYY", yValueFormatString: "#,##0.#", dataPoints: [';var c=[];for(a=0;a<e;){n+="{ x: new Date("+t[a].anho+", "+(Number(t[a].ta_mes)-1)+"), y: "+Number(t[a].tm_total).toFixed(2)+" },",o+="<td>"+Number(t[a].tm_total).toFixed(2)+"</td>";var u={x:new Date(t[a].anho,Number(t[a].ta_mes)-1),y:Number(t[a].tm_total)};c.push(u),++a}n=n.substr(0,n.length-1),n+="]},",o+="</tr><tr>",r+='{ type: "line", name: "Avance", axisYType: "secondary", showInLegend: true, yValueFormatString: "#,##0", dataPoints: [';var m=[];for(a=0;a<e;){r+="{ x: new Date("+t[a].anho+", "+(Number(t[a].ta_mes)-1)+"), y: "+t[a].avance+" },",o+="<td>"+Number(t[a].avance).toFixed(2)+"</td>";var p={x:new Date(t[a].anho,Number(t[a].ta_mes)-1),y:Number(t[a].avance)};m.push(p),++a}r=r.substr(0,r.length-1),r+="]}",o+="</tr></tbody>"}var v=i+o;$("#tableReporte").html(v);var g="[";g+=l+n+r,g+="]";var b=[{type:"column",showInLegend:!0,name:"Axis Y-1",xValueFormatString:"####",dataPoints:d},{type:"column",showInLegend:!0,axisYType:"secondary",name:"Axis Y2-1",xValueFormatString:"####",dataPoints:c},{type:"spline",showInLegend:!0,axisYType:"secondary",axisYIndex:1,name:"Axis Y2-2",xValueFormatString:"####",dataPoints:m}];console.log(b);var h=new CanvasJS.Chart("chartContainer",{title:{text:"Gráfica de seguimiento"},axisX:{title:"Meses",valueFormatString:"MMM"},axisY:{title:"Meta (en soles)",titleFontColor:"#4F81BC",lineColor:"#4F81BC",labelFontColor:"#4F81BC",tickColor:"#4F81BC"},axisY2:{title:"Avance",titleFontColor:"#C0504E",lineColor:"#C0504E",labelFontColor:"#C0504E",tickColor:"#C0504E"},data:b});h.render()},error:function(t){console.log(t)}})}$(function(){BuscarDatos("1"),$("#btnSeguimiento").on("click",function(t){t.preventDefault(),openModalCallBack("#pnlSeguimiento",function(){ListarSeguimiento()})}),$("#btnConsultarSeguimiento").on("click",function(t){t.preventDefault(),ListarSeguimiento()}),$("#btnSearch").on("click",function(t){t.preventDefault(),datagrid.showAppBar(!0,"search"),$("#txtSearch").focus()}),$(".back-button").on("click",function(){$("#btnUnSelectAll").trigger("click")}),$("#btnNuevoDetalle").on("click",function(t){t.preventDefault(),openModalCallBack("#pnlRegisterItemDetalle",function(){})}),$("#btnAgregar").on("click",function(t){t.preventDefault();var e={td_idequilibrio:"0",ta_tipo_servicio:$("#ddlTipoDetalle").val(),tiposervicio:$("#ddlTipoDetalle option:selected").text(),tm_nombre:$("#txtObservacion_Detalle").val(),tm_total:$("#txtImporte").val()},a=addItemDetalle(e);$("#gvEvaluacion tbody").append(a),LimpiarFormDetalle(),calcularSuma(),closeCustomModal("#pnlRegisterItemDetalle"),LimpiarFormDetalle()}),$("#gvEvaluacion").on("click","a",function(t){t.preventDefault(),"delete"==this.getAttribute("data-action")&&eliminarElemento(this)}),$("#generic-actionbar").on("click touchend","button",function(t){t.preventDefault();var e=this.getAttribute("data-action");"delete"==e&&MessageBox({content:"¿Desea eliminar todo lo seleccionado?",width:"320px",height:"130px",buttons:[{primary:!0,content:"Eliminar",onClickButton:function(t){Eliminarequilibrio()}}],cancelButton:!0})}),$("#gvDatos").on("click touchend",".dropdown a",function(t){t.preventDefault();var e=this.getAttribute("data-action"),a=getParentsUntil(this,"#gvDatos",".dato"),i=a[0].getAttribute("data-idmodel");"edit"==e?GoToEdit(i):"delete"==e&&MessageBox({content:"¿Desea eliminar este elemento?",width:"320px",height:"130px",buttons:[{primary:!0,content:"Eliminar",onClickButton:function(t){EliminarItemequilibrio(a[0],"single")}}],cancelButton:!0})}),$("#btnNuevo").on("click",function(t){t.preventDefault(),GoToEdit("0")}),$("#btnGuardar").on("click",function(t){t.preventDefault(),GuardarDatos()})});var indexList=0,elemsSelected,progress=0,progressError=!1,datagrid=new DataList("#gvDatos",{onSearch:function(){BuscarDatos(datagrid.currentPage())}}),filaItem=0;