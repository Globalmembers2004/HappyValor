function LimpiarForm(){$("#txtCodigo").val(""),$("#txtNombre").val(""),$("#txtPesominsg").val(0),$("#txtPesomaxsg").val(0),$("#txtCalorias").val(0),$("#txtDocumento").val(""),Materialize.updateTextFields()}function GoToEdit(e){var t="#pnlForm";document.getElementById("hdIdPrimary").value="0",precargaExp(t,!0),LimpiarForm(),openModalCallBack(t,function(){"0"==e?precargaExp(t,!1):$.ajax({type:"GET",url:"services/dieta/dieta-getdetails.php",cache:!1,dataType:"json",data:"id="+e,success:function(e){e.length>0&&($("#hdIdPrimary").val(e[0].tm_iddieta),$("#txtPesominsg").val(e[0].tm_pesosg_min),$("#txtPesomaxsg").val(e[0].tm_pesosg_max),$("#txtCalorias").val(e[0].tm_calorias),$(".droping-air .help").text(e[0].tm_documento),$("#txtNombre").val(e[0].tm_nombre).focus(),Materialize.updateTextFields()),precargaExp(t,!1)},error:function(e){console.log(e)}})})}function BuscarDatos(e){var t="#gvDatos",a=t+" .gridview-content";precargaExp("#pnlListado",!0),$.ajax({type:"GET",url:"services/dieta/dieta-search.php",cache:!1,dataType:"json",data:{criterio:$("#txtSearch").val(),idempresa:$("#hdIdEmpresa").val(),idcentro:$("#hdIdCentro").val(),pagina:e},success:function(i){var n=i.length,o=0,r="";if(n>0){for(;o<n;){var s=i[o].tm_iddieta;r+='<li class="collection-item avatar no-border dato" data-idmodel="'+s+'"  data-baselement="'+t+'">',r+='<input name="chkItem[]" type="checkbox" class="oculto" value="'+s+'" />',r+='<i class="icon-select material-icons circle white-text">done</i><div class="layer-select"></div>',r+='<span class="title descripcion">'+i[o].tm_nombre+"</span>",r+="<p>Peso mínimo sin grasa: "+i[o].tm_pesosg_min+' - Peso máximo sin grasa: <span class="SinGrasa">'+i[o].tm_pesosg_max+"</span><br>",r+='<div class="grouped-buttons place-top-right padding5">',r+='<a class="padding5 mdl-button mdl-button--icon tooltipped" href="#" data-action="more" data-delay="50" data-position="bottom" data-tooltip="M&aacute;s"><i class="material-icons md-18">&#xE5D4;</i></a>',r+='<ul class="dropdown"><li><a href="#" data-action="edit" class="waves-effect">Editar</a></li><li><a href="#" data-action="delete" class="waves-effect">Eliminar</a></li></ul>',r+="</div>",r+='<div class="divider"></div>',r+="</li>",++o}datagrid.currentPage(datagrid.currentPage()+1),"1"==e?$(a).html(r):$(a).append(r)}else"1"==e&&$(a).html("<h2>No se encontraron resultados.</h2>");precargaExp("#pnlListado",!1)},error:function(e){console.log(e)}})}function GuardarDatos(){var e=(document.getElementById("hdFoto"),fileValue),t=new FormData;precargaExp("#pnlForm",!0),t.append("btnGuardar","btnGuardar"),t.append("hdIdEmpresa",$("#hdIdEmpresa").val()),t.append("hdIdCentro",$("#hdIdCentro").val()),t.append("archivo",e);var a=$("#pnlForm :input").serializeArray();Array.prototype.forEach.call(a,function(e){t.append(e.name,e.value)}),$.ajax({type:"POST",url:"services/dieta/dieta-post.php",contentType:!1,processData:!1,cache:!1,data:t,dataType:"json",success:function(e){precargaExp("#pnlForm",!1),createSnackbar(e.titulomsje),Number(e.rpta)>0&&(closeCustomModal("#pnlForm"),paginaGeneral=1,BuscarDatos("1"))},error:function(e){console.log(e)}})}function EliminarDieta(){indexList=0,elemsSelected=$("#gvDatos .selected"),EliminarItemDieta(elemsSelected[0],"multiple")}function EliminarItemDieta(e,t){var a=new FormData,i=e.getAttribute("data-idmodel");a.append("btnEliminar","btnEliminar"),a.append("hdIdDieta",i),$.ajax({url:"services/dieta/dieta-post.php",type:"POST",dataType:"json",data:a,cache:!1,contentType:!1,processData:!1,success:function(a){var i="",n=!1;"0"==a.rpta?(n=!0,i="No se puede eliminar"):($(e).fadeOut(400,function(){$(this).remove()}),"multiple"==t?(++indexList,indexList<=elemsSelected.length-1?EliminarItemDieta(elemsSelected[indexList],t):(n=!0,i=a.titulomsje)):"single"==t&&(n=!0,i=a.titulomsje)),n&&(createSnackbar(i),$(".actionbar").hasClass("is-visible")&&$(".back-button").trigger("click"))},error:function(e){console.log(e)}})}function Buscar(){BuscarDatos("1")}function prepareImport(e){var t=["pdf"],a="",i="";return fileValue=e[0],i=e[0].name,a=i.split(".").pop().toLowerCase(),$.inArray(a,t)==-1?(MessageBox("Extensi&oacute;n no v&aacute;lida","El tipo de archivo no es compatible para la importaci&oacute;n","[Aceptar]",function(){}),!1):($(".droping-air .help").text(i),void $(".droping-air").addClass("dropped"))}$(function(){BuscarDatos("1"),$(".droping-air .file-import").on({dragenter:function(e){e.stopPropagation(),e.preventDefault()},dragover:function(e){e.stopPropagation(),e.preventDefault()},change:function(e){e.preventDefault(),prepareImport(this.files)},drop:function(e){e.preventDefault();var t=e.originalEvent.dataTransfer.files;prepareImport(t)}}),$("#btnSearch").on("click",function(e){e.preventDefault(),datagrid.showAppBar(!0,"search"),$("#txtSearch").focus()}),$(".back-button").on("click",function(){$("#btnUnSelectAll").trigger("click")}),$("#generic-actionbar").on("click touchend","button",function(e){e.preventDefault();var t=this.getAttribute("data-action");"delete"==t&&MessageBox({content:"¿Desea eliminar todo lo seleccionado?",width:"320px",height:"130px",buttons:[{primary:!0,content:"Eliminar",onClickButton:function(e){EliminarDieta()}}],cancelButton:!0})}),$("#gvDatos").on("click touchend",".dropdown a",function(e){e.preventDefault();var t=this.getAttribute("data-action"),a=getParentsUntil(this,"#gvDatos",".dato"),i=a[0].getAttribute("data-idmodel");"edit"==t?GoToEdit(i):"delete"==t&&MessageBox({content:"¿Desea eliminar este elemento?",width:"320px",height:"130px",buttons:[{primary:!0,content:"Eliminar",onClickButton:function(e){EliminarItemDieta(a[0],"single")}}],cancelButton:!0})}),$("#btnNuevo").on("click",function(e){e.preventDefault(),GoToEdit("0")}),$("#btnGuardar").on("click",function(e){e.preventDefault(),GuardarDatos()})});var fileValue,indexList=0,elemsSelected,progress=0,progressError=!1,datagrid=new DataList("#gvDatos",{onSearch:function(){BuscarDatos(datagrid.currentPage())}});