function Guardar(){var e=new FormData,a=$("#pnlForm :input").serializeArray();e.append("btnGuardar","btnGuardar"),e.append("hdIdEmpresa",$("#hdIdEmpresa").val()),e.append("hdIdCentro",$("#hdIdCentro").val()),e.append("hdIdCliente",getParameterByName("idcliente")),Array.prototype.forEach.call(a,function(a){e.append(a.name,a.value)}),$.ajax({type:"POST",url:"services/dietacliente/dietacliente-post.php",cache:!1,contentType:!1,processData:!1,dataType:"json",data:e,success:function(e){createSnackbar(e.titulomsje),"0"!=e.rpta&&(closeCustomModal("#pnlForm"),BuscarDatos("1"))},error:function(e){console.log(e)}})}function BuscarDatos(e){var a="#gvDatos",t=a+" .gridview-content";precargaExp("#pnlListado",!0),$.ajax({type:"GET",url:"services/dietacliente/dietacliente-search.php",cache:!1,dataType:"json",data:{criterio:$("#txtSearch").val(),idempresa:$("#hdIdEmpresa").val(),idcentro:$("#hdIdCentro").val(),idcliente:getParameterByName("idcliente"),pagina:e},success:function(i){var n=i.length,o=0,l="";if(n>0){for(;o<n;){var c=i[o].tm_iddietasocio;l+='<li class="collection-item avatar no-border dato" data-idmodel="'+c+'"  data-baselement="'+a+'">',l+='<input name="chkItem[]" type="checkbox" class="oculto" value="'+c+'" />',l+='<i class="icon-select material-icons circle white-text">done</i><div class="layer-select"></div>',l+='<span class="title descripcion"> CALORIAS : '+i[o].tm_calorias+"</span> <br />",l+='<span class="correo">DURACI&Oacute;N: Desde '+ConvertMySQLDate(i[o].tm_fechaInicial)+"</span> al "+ConvertMySQLDate(i[o].tm_fechaFinal)+"</p>",l+='<div class="grouped-buttons place-top-right padding5">',l+='<a class="padding5 mdl-button mdl-button--icon tooltipped" href="#" data-action="more" data-delay="50" data-position="bottom" data-tooltip="M&aacute;s"><i class="material-icons md-18">&#xE5D4;</i></a>',l+='<ul class="dropdown"><li><a href="#" data-action="edit" class="waves-effect">Editar</a></li><li><a href="#" data-action="delete" class="waves-effect">Eliminar</a></li></ul>',l+="</div>",l+='<div class="divider"></div>',l+="</li>",++o}"1"==e?$(t).html(l):$(t).append(l)}else"1"==e&&$(t).html("<h2>No se encontraron resultados.</h2>");precargaExp("#pnlListado",!1)},error:function(e){console.log(e)}})}function EliminarDieta(){indexList=0,elemsSelected=$("#gvDatos .selected"),eliminarDieta(elemsSelected[0],"multiple")}function eliminarDieta(e,a){var t=new FormData,i=e.getAttribute("data-idmodel");t.append("btnEliminar","btnEliminar"),t.append("hdIdDietacliente",i),$.ajax({url:"services/dietacliente/dietacliente-post.php",type:"POST",dataType:"json",data:t,cache:!1,contentType:!1,processData:!1,success:function(t){var i="",n=!1;"0"==t.rpta?(n=!0,i="No se puede eliminar"):($(e).fadeOut(400,function(){$(this).remove()}),"multiple"==a?(++indexList,indexList<=elemsSelected.length-1?eliminarDieta(elemsSelected[indexList],a):(n=!0,i=t.titulomsje)):"single"==a&&(n=!0,i=t.titulomsje)),n&&(createSnackbar(i),$(".actionbar").hasClass("is-visible")&&$(".back-button").trigger("click"))},error:function(e){console.log(e)}})}function GoToEdit(e){var a="#pnlForm";document.getElementById("hdIdPrimary").value="0",precargaExp(a,!0),LimpiarForm(),openModalCallBack(a,function(){"0"==e?precargaExp(a,!1):$.ajax({type:"GET",url:"services/dietacliente/dietacliente-getdetails.php",cache:!1,dataType:"json",data:"id="+e,success:function(e){e.length>0&&($("#hdIdPrimary").val(e[0].tm_iddietasocio),$("#txtGrasaCorporal").val(e[0].tm_calorias),$("#ddlDieta").val(e[0].tm_iddieta),$("#txtFechaInicio").val(ConvertMySQLDate(e[0].tm_fechaInicial)),$("#txtFechaFinal").val(ConvertMySQLDate(e[0].tm_fechaFinal)),$("#txtObservaciones").val(e[0].tm_documento),Materialize.updateTextFields()),precargaExp(a,!1)},error:function(e){console.log(e)}})})}function LimpiarForm(){$("#txtGrasaCorporal").val("0"),$("#ddlDieta")[0].selectedIndex=0,$("#txtFechaInicio").val(moment().format("DD/MM/YYYY")),$("#txtFechaFinal").val(moment().format("DD/MM/YYYY")),$("#txtObservaciones").val("")}$(function(){BuscarDatos("1"),$(".datepicker").pickadate({format:"dd/mm/yyyy",selectMonths:!0,selectYears:15,today:"Today",clear:"Clear",close:"Ok",closeOnSelect:!1}),$("#btnNuevo").on("click",function(e){e.preventDefault(),GoToEdit("0")}),$("#btnGuardar").on("click",function(e){e.preventDefault(),Guardar()}),$("#gvDatos").on("click touchend",".dropdown a",function(e){e.preventDefault();var a=this.getAttribute("data-action"),t=getParentsUntil(this,"#gvDatos",".dato"),i=t[0].getAttribute("data-idmodel");"edit"==a?GoToEdit(i):"delete"==a&&MessageBox({content:"Â¿Desea eliminar este elemento?",width:"320px",height:"130px",buttons:[{primary:!0,content:"Eliminar",onClickButton:function(e){eliminarDieta(t[0],"single")}}],cancelButton:!0})})});var filaItem=0;