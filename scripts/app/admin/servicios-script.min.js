function LimpiarForm(){$("#hdIdPrimary").val(""),$("#txtNombreServicio").val(""),$("#chkMembresia")[0].checked=!1,$("#txtPrecio").val(0),$("#txtDias").val(0),$("#txtVencimiento").val(0),Materialize.updateTextFields()}function GoToEdit(e){var t="#pnlForm";document.getElementById("hdIdPrimary").value="0",document.getElementById("hdFoto").value="no-set",precargaExp(t,!0),resetFoto("new"),LimpiarForm(),openModalCallBack(t,function(){"0"==e?precargaExp(t,!1):$.ajax({type:"GET",url:"services/servicios/servicios-getdetails.php",cache:!1,dataType:"json",data:"id="+e,success:function(e){if(e.length>0){var a=e[0].tm_foto,i=a.replace("_o","_s255");$("#hdIdPrimary").val(e[0].tm_idservicio),$("#chkMembresia").prop("checked",1==e[0].tm_membresia),$("#txtPrecio").val(e[0].tm_precio),$("#txtDias").val(e[0].tm_dias),$("#txtVencimiento").val(e[0].tm_dias_vencimiento),"no-set"!=a?setFoto(i):i="images/user-nosetimg-233.jpg",imgFoto.setAttribute("data-src",i),hdFoto.value=a,$("#txtNombreServicio").val(e[0].tm_nombre).focus(),Materialize.updateTextFields()}precargaExp(t,!1)},error:function(e){console.log(e)}})})}function BuscarDatos(e){var t="#gvDatos",a=t+" .gridview-content";precargaExp("#gvDatos",!0),$.ajax({type:"GET",url:"services/servicios/servicios-search.php",cache:!1,dataType:"json",data:{tipobusqueda:"1",idempresa:$("#hdIdEmpresa").val(),idcentro:$("#hdIdCentro").val(),id:0,criterio:"",pagina:e},success:function(i){var o=i.length,r=0,n="";if(o>0){for(;r<o;){var c=i[r].tm_idservicio,s=i[r].tm_foto.replace("_o","_s42");n+='<li class="collection-item avatar no-border dato" data-idmodel="'+c+'"  data-baselement="'+t+'">',n+='<input name="chkItem[]" type="checkbox" class="oculto" value="'+c+'" />',n+='<i class="icon-select material-icons circle white-text">done</i><div class="layer-select"></div>',n+="no-set"==s?'<i class="material-icons circle">&#xE853;</i>':'<img src="'+s+'" alt="" class="circle">',n+='<span class="title descripcion">'+i[r].tm_nombre+"</span>",n+="<p>Membres&iacute;a: "+i[r].tm_membresia+' - D&iacute;as: <span class="dias">'+i[r].tm_dias+"</span><br>",n+='<span class="precio">Precio: '+i[r].tm_precio+"</p>",n+='<div class="grouped-buttons place-top-right padding5">',n+='<a class="padding5 mdl-button mdl-button--icon tooltipped" href="#" data-action="more" data-delay="50" data-position="bottom" data-tooltip="M&aacute;s"><i class="material-icons md-18">&#xE5D4;</i></a>',n+='<ul class="dropdown"><li><a href="#" data-action="edit" class="waves-effect">Editar</a></li><li><a href="#" data-action="delete" class="waves-effect">Eliminar</a></li></ul>',n+="</div>",n+='<div class="divider"></div>',n+="</li>",++r}datagrid.currentPage(datagrid.currentPage()+1),"1"==e?$(a).html(n):$(a).append(n)}else"1"==e&&$(a).html("<h2>No se encontraron resultados.</h2>");precargaExp("#pnlListado",!1)},error:function(e){console.log(e)}})}function GuardarDatos(){var e=document.getElementById("hdFoto"),t=fileValue,a=new FormData;precargaExp("#pnlForm",!0),"images/user-nosetimg-233.jpg"==e.value&&(e.value="no-set"),a.append("btnGuardar","btnGuardar"),a.append("hdIdEmpresa",$("#hdIdEmpresa").val()),a.append("hdIdCentro",$("#hdIdCentro").val()),a.append("archivo",t);var i=$("#pnlForm :input").serializeArray();Array.prototype.forEach.call(i,function(e){a.append(e.name,e.value)}),$.ajax({type:"POST",url:"services/servicios/servicios-post.php",contentType:!1,processData:!1,cache:!1,data:a,dataType:"json",success:function(e){precargaExp("#pnlForm",!1),createSnackbar(e.titulomsje),"0"!=e.rpta&&(closeCustomModal("#pnlForm"),BuscarDatos("1"))}})}function EliminarServicio(){indexList=0,elemsSelected=$("#gvDatos .selected"),EliminarItemServicio(elemsSelected[0],"multiple")}function EliminarItemServicio(e,t){var a=new FormData,i=e.getAttribute("data-idmodel");a.append("btnEliminar","btnEliminar"),a.append("hdIdServicio",i),$.ajax({url:"services/servicios/servicios-post.php",type:"POST",dataType:"json",data:a,cache:!1,contentType:!1,processData:!1,success:function(a){var i="",o=!1;"0"==a.rpta?(o=!0,i="No se puede eliminar"):($(e).fadeOut(400,function(){$(this).remove()}),"multiple"==t?(++indexList,indexList<=elemsSelected.length-1?EliminarItemServicio(elemsSelected[indexList],t):(o=!0,i=a.titulomsje)):"single"==t&&(o=!0,i=a.titulomsje)),o&&(createSnackbar(i),$(".actionbar").hasClass("is-visible")&&$(".back-button").trigger("click"))},error:function(e){console.log(e)}})}function Buscar(){BuscarDatos("1")}$(function(){BuscarDatos("1"),$("#btnSearch").on("click",function(e){e.preventDefault(),datagrid.showAppBar(!0,"search"),$("#txtSearch").focus()}),$(".back-button").on("click",function(){$("#btnUnSelectAll").trigger("click")}),$("#generic-actionbar").on("click touchend","button",function(e){e.preventDefault();var t=this.getAttribute("data-action");"delete"==t&&MessageBox({content:"¿Desea eliminar todo lo seleccionado?",width:"320px",height:"130px",buttons:[{primary:!0,content:"Eliminar",onClickButton:function(e){EliminarServicio()}}],cancelButton:!0})}),$("#gvDatos").on("click touchend",".dropdown a",function(e){e.preventDefault();var t=this.getAttribute("data-action"),a=getParentsUntil(this,"#gvDatos",".dato"),i=a[0].getAttribute("data-idmodel");"edit"==t?GoToEdit(i):"delete"==t&&MessageBox({content:"¿Desea eliminar este elemento?",width:"320px",height:"130px",buttons:[{primary:!0,content:"Eliminar",onClickButton:function(e){EliminarItemServicio(a[0],"single")}}],cancelButton:!0})}),$("#btnNuevo").on("click",function(e){e.preventDefault(),GoToEdit("0")}),$("#btnGuardar").on("click",function(e){e.preventDefault(),GuardarDatos()})});var indexList=0,elemsSelected,progress=0,progressError=!1,datagrid=new DataList("#gvDatos",{onSearch:function(){BuscarDatos(datagrid.currentPage())}});