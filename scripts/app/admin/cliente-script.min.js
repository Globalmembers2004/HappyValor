function LimpiarForm(){$("#hdIdPrimary").val(""),$("#txtnroDNI").val(""),$("#rbSexo__Masculino")[0].checked=!0,$("#txtFechaNacimiento").val(""),$("#txtApellidos").val(""),$("#txtNombres").val(""),$("#txtTelefono").val(""),$("#txtCelular").val(""),$("#txtEmail").val(""),$("#txtFacebook").val("")}function removeValidFormRegister(){$("#txtnroDNI").rules("remove"),$("#txtFechaNacimiento").rules("remove"),$("#txtNombres").rules("remove"),$("#txtApellidos").rules("remove"),$("#txtCelular").rules("remove"),$("#txtEmail").rules("remove")}function addValidFormRegister(){$("#txtnroDNI").rules("add",{required:!0}),$("#txtFechaNacimiento").rules("add",{required:!0}),$("#txtNombres").rules("add",{required:!0}),$("#txtApellidos").rules("add",{required:!0}),$("#txtCelular").rules("add",{required:!0}),$("#txtEmail").rules("add",{required:!0,email:!0})}function GoToEdit(e){var t="#pnlForm";document.getElementById("hdIdPrimary").value="0",document.getElementById("hdFoto").value="no-set",precargaExp(t,!0),resetFoto("new"),LimpiarForm(),removeValidFormRegister(),addValidFormRegister(),openModalCallBack(t,function(){"0"==e?precargaExp(t,!1):$.ajax({type:"GET",url:"services/clientes/cliente-getdetails.php",cache:!1,dataType:"json",data:"id="+e,success:function(e){if(e.length>0){var a=e[0].tm_foto,i=a.replace("_o","_s255");$("#hdIdPrimary").val(e[0].tm_idcliente),$("#txtNombres").val(e[0].tm_nombres),$("#txtApellidos").val(e[0].tm_apellidos),$("#txtnroDNI").val(e[0].tm_nrodni),$("#txtFechaNacimiento").val(ConvertMySQLDate(e[0].tm_fechanac)),$("#rbSexo__Masculino")[0].checked="1"==e[0].tm_sexo,$("#rbSexo__Femenino")[0].checked="1"!=e[0].tm_sexo,$("#txtTelefono").val(e[0].tm_telefono),$("#txtCelular").val(e[0].tm_celular),$("#txtEmail").val(e[0].tm_email),$("#txtFacebook").val(e[0].tm_facebook),"no-set"!=a?setFoto(i):i="images/user-nosetimg-233.jpg",imgFoto.setAttribute("data-src",i),$("#hdFoto").val(a),$("#txtnroDNI").val(e[0].tm_nrodni).focus(),Materialize.updateTextFields()}precargaExp(t,!1)},error:function(e){console.log(e)}})})}function BuscarDatos(e){var t="#gvDatos",a=t+" .gridview-content";precargaExp("#pnlListado",!0),$.ajax({type:"GET",url:"services/cliente/cliente-search.php",cache:!1,dataType:"json",data:{tipobusqueda:"4",criterio:$("#txtSearch").val(),idempresa:$("#hdIdEmpresa").val(),idcentro:$("#hdIdCentro").val(),pagina:e},success:function(i){var n=i.length,o=0,r="",l="",c="";if(n>0){for(;o<n;){var d=i[o].tm_idcliente,s=i[o].tm_foto.replace("_o","_s42");Number(i[o].Deuda)>0?(l='<i class="material-icons">&#xE8DB;</i>',c="#FFAD64"):""==i[o].inicial?(l='<i class="material-icons">&#xE5CD;</i>',c="#FF4141"):(l='<i class="material-icons">&#xE8DC;</i>',c="#57DF65"),r+='<li class="collection-item avatar no-border dato" data-idmodel="'+d+'"  data-baselement="'+t+'" style="background-color: '+c+';">',r+='<input name="chkItem[]" type="checkbox" class="oculto" value="'+d+'" />',r+='<i class="icon-select material-icons circle white-text">done</i><div class="layer-select"></div>',r+="no-set"==s?'<i class="material-icons circle">&#xE853;</i>':'<img src="'+s+'" alt="" class="circle">',r+='<span class="title descripcion white-text"> Nombres: '+i[o].tm_nombres+"</span>",r+='<p class="white-text">Apellidos: '+i[o].tm_apellidos+' - DNI: <span class="dni">'+i[o].tm_nrodni+"<p>",r+='<p class="white-text">Cumpleaños: '+moment(i[o].tm_fechanac).format("DD")+" de "+moment(i[o].tm_fechanac).format("MMMM")+'<i class="material-icons">&#xE7E9;</i><p>',r+='<p class="white-text">Celular: '+i[o].tm_celular+' - Teléfono fijo: <span class="Fijo">'+i[o].tm_telefono+"</span><br>",i[o].inicial.length>0&&(r+='<span class="correo white-text">Membresía: Desde: '+ConvertMySQLDate(i[o].inicial)+"</span> hasta: "+ConvertMySQLDate(i[o]["final"])+" "),r+=" Con deuda de: "+Number(i[o].Deuda).toFixed(2)+"</p>",r+='<div class="grouped-buttons place-top-right padding5">',r+='<a class="padding5 mdl-button mdl-button--icon tooltipped white-text" href="#" data-action="more" data-delay="50" data-position="bottom" data-tooltip="M&aacute;s"><i class="material-icons md-18">&#xE5D4;</i></a>',r+='<ul class="dropdown"><li><a href="#" data-action="edit" class="waves-effect">Editar</a></li><li><a href="#" data-action="lineacredito" class="waves-effect">L&iacute;nea de cr&eacute;dito</a></li><li><a href="#" data-action="asistenciacliente" class="waves-effect">Asistencia</a></li><li><a href="#" data-action="clasescliente" class="waves-effect">Clases</a></li><li><a href="#" data-action="evaluacioncliente" class="waves-effect">Evaluaci&oacute;n</a></li><li><a href="#" data-action="rutinacliente" class="waves-effect">Rutinas</a></li><li><a href="#" data-action="dietacliente" class="waves-effect">Dietas</a></li><li><a href="#" data-action="delete" class="waves-effect">Eliminar</a></li><li><a href="#" data-action="fingerprint" class="waves-effect">Huella digital</a></li></ul>',r+="</div>",r+='<div class="divider"></div>',r+='<div class="icon-status place-bottom-right margin10 white-text">'+l+"</div>",r+="</li>",++o}datagrid.currentPage(datagrid.currentPage()+1),"1"==e?$(a).html(r):$(a).append(r)}else"1"==e&&$(a).html("<h2>No se encontraron resultados.</h2>");precargaExp("#pnlListado",!1)},error:function(e){console.log(e)}})}function GuardarDatos(){var e=document.getElementById("hdFoto"),t=fileValue,a=new FormData;if($("#form1").valid()){precargaExp("#pnlForm",!0),"images/user-nosetimg-233.jpg"==e.value&&(e.value="no-set"),a.append("btnGuardar","btnGuardar"),a.append("hdIdEmpresa",$("#hdIdEmpresa").val()),a.append("hdIdcentro",$("#hdIdCentro").val()),a.append("archivo",t);var i=$("#pnlForm :input").serializeArray();Array.prototype.forEach.call(i,function(e){a.append(e.name,e.value)}),$.ajax({type:"POST",url:"services/cliente/cliente-post.php",contentType:!1,processData:!1,cache:!1,data:a,dataType:"json",success:function(e){precargaExp("#pnlForm",!1),createSnackbar(e.titulomsje),Number(e.rpta)>0&&(closeCustomModal("#pnlForm"),paginaGeneral=1,BuscarDatos("1"))},error:function(e){console.log(e)}})}}function Eliminarcliente(){indexList=0,elemsSelected=$("#gvDatos .selected"),EliminarItemcliente(elemsSelected[0],"multiple")}function EliminarItemcliente(e,t){var a=new FormData,i=e.getAttribute("data-idmodel");a.append("btnEliminar","btnEliminar"),a.append("hdIdCliente",i),$.ajax({url:"services/cliente/cliente-post.php",type:"POST",dataType:"json",data:a,cache:!1,contentType:!1,processData:!1,success:function(a){var i="",n=!1;"0"==a.rpta?(n=!0,i="No se puede eliminar"):($(e).fadeOut(400,function(){$(this).remove()}),"multiple"==t?(++indexList,indexList<=elemsSelected.length-1?EliminarItemcliente(elemsSelected[indexList],t):(n=!0,i=a.titulomsje)):"single"==t&&(n=!0,i=a.titulomsje)),n&&(createSnackbar(i),$(".actionbar").hasClass("is-visible")&&$(".back-button").trigger("click"))},error:function(e){console.log(e)}})}function Buscar(){BuscarDatos("1")}function navigateInFrame(e){if(0==$(e).find("iframe").length){var t="?pag=admin&subpag="+e.substr(1)+"&op=list&idcliente="+idcliente_selected,a=document.createElement("iframe");a.setAttribute("scrolling","no"),a.setAttribute("marginwidth","0"),a.setAttribute("marginheight","0"),a.setAttribute("width","100%"),a.setAttribute("height","100%"),a.setAttribute("frameborder","no"),a.setAttribute("src",t),a.addEventListener("load",function(e){}),$(e+" .mdl-tabs__panel-content").append(a)}}function GoToDetalleCliente(e,t){idcliente_selected=e,$("#tabDetalleCliente .mdl-tabs__panel-content iframe").remove(),openModalCallBack("#pnlDetalleCliente",function(){$('#tabDetalleCliente .mdl-tabs__tab[href="#'+t+'"] span').trigger("click")})}function ListarLineaCredito(e){$.ajax({type:"GET",url:"services/lineacredito/lineacredito-search.php",cache:!1,dataType:"json",data:{tipobusqueda:"1",id:$("#hdIdCliente").val()},success:function(e){var t=0,a=e.length,i="";if(a>0){for(;t<a;)i+='<tr data-idlineacredito="'+e[t].td_idlineacredito+'">',i+='<td class="align-center">'+(t+1)+"</td>",i+='<td class="align-center">'+ConvertMySQLDate(e[t].FechaReg)+"</td>",i+='<td class="align-right">'+Number(e[t].importelinea).toFixed(2)+"</td>",i+='<td class="align-right">'+Number(e[t].consumo).toFixed(2)+"</td>",i+='<td class="align-right">'+Number(e[t].cancelado).toFixed(2)+"</td>",i+='<td class="align-right">'+Number(e[t].saldo).toFixed(2)+"</td>",i+='<td class="align-center no-padding"><button class="mdl-button mdl-button--colored tooltipped margin5" type="button" data-action="deudas" data-delay="50" data-position="bottom" data-tooltip="DEUDAS">DEUDAS</button></td>',i+='<td class="align-center no-padding"><button class="mdl-button mdl-button--colored tooltipped margin5" type="button" data-action="cobros" data-delay="50" data-position="bottom" data-tooltip="COBROS">COBROS</button></td>',i+="</tr>",++t;$("#tableLineaCredito .empty_state").addClass("hide"),$("#tableLineaCredito .table-responsive-vertical").removeClass("hide")}else $("#tableLineaCredito .empty_state").removeClass("hide"),$("#tableLineaCredito .table-responsive-vertical, #btnCobroDeuda").addClass("hide");$("#tableLineaCredito tbody").html(i)},error:function(e){console.log(e)}})}function CobrarDeuda(){var e=new FormData,t=$("#pnlCobroDeuda :input").serializeArray();e.append("btnCobrarDeuda","btnCobrarDeuda"),Array.prototype.forEach.call(t,function(t){e.append(t.name,t.value)}),$.ajax({url:"services/lineacredito/lineacredito-post.php",type:"POST",dataType:"json",data:e,cache:!1,contentType:!1,processData:!1,success:function(e){createSnackbar(e.titulomsje),"0"!=e.rpta&&(closeCustomModal("#pnlCobroDeuda"),ListarDeudaCobrar(idlineacredito),ListarLineaCredito("1"))},error:function(e){console.log(e)}})}function GuardarLineaCredito(){var e=new FormData,t=$("#pnlFormLineaCredito :input").serializeArray();e.append("btnAplicarLineaCredito","btnAplicarLineaCredito"),e.append("hdIdCliente",$("#hdIdCliente").val()),Array.prototype.forEach.call(t,function(t){e.append(t.name,t.value)}),$.ajax({url:"services/lineacredito/lineacredito-post.php",type:"POST",dataType:"json",data:e,cache:!1,contentType:!1,processData:!1,success:function(e){createSnackbar(e.titulomsje),"0"!=e.rpta&&(closeCustomModal("#pnlFormLineaCredito"),ListarLineaCredito("1"))},error:function(e){console.log(e)}})}function ListarDeudaCobrar(e){$.ajax({type:"GET",url:"services/lineacredito/deudacobrar-search.php",cache:!1,dataType:"json",data:{tipobusqueda:"1",id:e},success:function(e){var t=0,a=e.length,i="";if(a>0){for(;t<a;)i+='<tr data-iddeuddacobrar="'+e[t].td_iddeudacobrar+'">',i+='<td class="align-center">'+(t+1)+"</td>",i+='<td class="align-center">'+ConvertMySQLDate(e[t].td_fechagen)+"</td>",i+='<td class="align-center">'+ConvertMySQLDate(e[t].td_fechainipago)+"</td>",i+='<td class="align-center">'+ConvertMySQLDate(e[t].td_fechafinpago)+"</td>",i+='<td class="align-right">'+Number(e[t].td_valormora).toFixed(2)+"</td>",i+='<td class="align-right">'+Number(e[t].td_importe).toFixed(2)+"</td>",i+='<td class="align-right">'+Number(e[t].td_importecancelado).toFixed(2)+"</td>",i+='<td class="align-right">'+Number(e[t].saldo).toFixed(2)+"</td>",i+='<td class="align-center">'+e[t].EstadoDeuda+"</td>",i+='<td class="align-center no-padding"><button class="mdl-button mdl-button--colored tooltipped margin5" type="button" data-action="pay" data-delay="50" data-position="bottom" data-tooltip="Cobrar deuda">Cobrar deuda</button></td>',i+="</tr>",++t;$("#tableLineaDetalleCredito .empty_state").addClass("hide"),$("#tableLineaDetalleCredito .table-responsive-vertical").removeClass("hide")}else $("#tableLineaDetalleCredito .empty_state").removeClass("hide"),$("#tableLineaDetalleCredito .table-responsive-vertical").addClass("hide");$("#tableLineaDetalleCredito tbody").html(i)},error:function(e){console.log(e)}})}function LimpiarForm_CobroDeuda(){$("#ddlTipoOperacion")[0].selectedIndex=0,$("#ddlTipoOperacion").trigger("change"),$("#ddlBanco")[0].selectedIndex=0,$("#txtNroCuentaBancaria").val(""),$("#txtNroOperacion").val(""),$("#txtFechaPago").val(moment().format("DD/MM/YYYY")),$("#txtImportePago").val("0.00"),$("#txtImporteMora").val("0.00")}$(function(){moment.locale("es"),BuscarDatos("1"),$("#ddlTipoOperacion").on("change",function(e){e.preventDefault(),"01"==$(this).val()?$(".rowOperacion").addClass("hide"):$(".rowOperacion").removeClass("hide")}),$("#txtImporteLinea").on("focus",function(e){e.preventDefault(),this.select()}),$("#tableLineaCredito").on("click",'button[data-action="deudas"]',function(e){e.preventDefault();var t=getParentsUntil(this,"#tableLineaCredito","tr");t=t[0],openModalCallBack("#pnlDetalleLineaCredito",function(){idlineacredito=t.getAttribute("data-idlineacredito"),ListarDeudaCobrar(idlineacredito)})}),$("#tableLineaDetalleCredito").on("click",'button[data-action="pay"]',function(e){e.preventDefault();var t=getParentsUntil(this,"#tableLineaDetalleCredito","tr");t=t[0];var a=t.getAttribute("data-iddeuddacobrar");$("#hdIdDeudaCobrar").val(a),LimpiarForm_CobroDeuda(),openModalCallBack("#pnlCobroDeuda",function(){})}),$("#btnCobroDeuda").on("click",function(e){e.preventDefault(),openModalCallBack("#pnlCobroDeuda",function(){})}),$("#btnCobrarDeuda").on("click",function(e){e.preventDefault(),CobrarDeuda()}),$("#btnGenerarLineaCredito").on("click",function(e){e.preventDefault(),openModalCallBack("#pnlFormLineaCredito",function(){})}),$("#btnAplicarLineaCredito").on("click",function(e){e.preventDefault(),GuardarLineaCredito()}),cargarDatePicker("#txtFechaNacimiento",function(e,t){}),$("#btnSearch").on("click",function(e){e.preventDefault(),datagrid.showAppBar(!0,"search"),$("#txtSearch").focus()}),$(".back-button").on("click",function(){$("#btnUnSelectAll").trigger("click")}),$("#generic-actionbar").on("click touchend","button",function(e){e.preventDefault();var t=this.getAttribute("data-action");"delete"==t&&MessageBox({content:"¿Desea eliminar todo lo seleccionado?",width:"320px",height:"130px",buttons:[{primary:!0,content:"Eliminar",onClickButton:function(e){Eliminarcliente()}}],cancelButton:!0})}),$("#gvDatos").on("click touchend",".dropdown a",function(e){e.preventDefault();var t=this.getAttribute("data-action"),a=getParentsUntil(this,"#gvDatos",".dato"),i=a[0].getAttribute("data-idmodel");"edit"==t?GoToEdit(i):"lineacredito"==t?($("#hdIdCliente").val(i),openModalCallBack("#pnlLineaCredito",function(){ListarLineaCredito("1")})):"asistenciacliente"==t||"clasescliente"==t||"evaluacioncliente"==t||"rutinacliente"==t||"dietacliente"==t?GoToDetalleCliente(i,t):"delete"==t?MessageBox({content:"¿Desea eliminar este elemento?",width:"320px",height:"130px",buttons:[{primary:!0,content:"Eliminar",onClickButton:function(e){EliminarItemcliente(a[0],"single")}}],cancelButton:!0}):"fingerprint"==t&&openModalCallBack("#pnlFingerPrint",function(){})}),$("#tabDetalleCliente .mdl-tabs__tab-bar").on("click",".mdl-tabs__tab span",function(e){var t=$(this).parent().attr("href");null!==t&&navigateInFrame(t)}),$("#btnNuevo").on("click",function(e){e.preventDefault(),GoToEdit("0")}),$("#btnGuardar").on("click",function(e){e.preventDefault(),GuardarDatos()}),$("#form1").validate({lang:"es",errorElement:"div",errorPlacement:function(e,t){var a=$(t).data("error");a?$(a).append(e):e.insertAfter(t)}})});var idcliente_selected=0,indexList=0,elemsSelected,progress=0,progressError=!1,datagrid=new DataList("#gvDatos",{onSearch:function(){BuscarDatos(datagrid.currentPage())}}),idlineacredito=0;