function LimpiarForm(){$("#txtImcActual").val("0"),$("#txtImcMeta").val("0"),$("#txtFechaInicio").val(moment().format("DD/MM/YYYY")),$("#txtFechaFinal").val(moment().format("DD/MM/YYYY")),$("#gvArticuloMenu tbody").html("")}function LimpiarFormDetalle(){$("#txtDetalle").val(""),$("#ddlZonaCorporal")[0].selectedIndex=0,$("#ddlEquipo")[0].selectedIndex=0,$("#txtSeries").val("0"),$("#txtRepeticiones").val("0"),$("#txtPeso").val("0")}function eliminarElemento(e){var t=getParentsUntil(e,"#gvArticuloMenu",".dato");MessageBox({content:"¿Desea quitar este item?",width:"320px",height:"130px",buttons:[{primary:!0,content:"Quitar item",onClickButton:function(e){$(t[0]).remove()}}],cancelButton:!0})}function GoToEdit(e){var t="#pnlForm";document.getElementById("hdIdPrimary").value="0",precargaExp(t,!0),LimpiarForm(),openModalCallBack(t,function(){"0"==e?precargaExp(t,!1):$.ajax({type:"GET",url:"services/rutinacliente/rutinacliente-getdetails.php",cache:!1,dataType:"json",data:"id="+e,success:function(e){e.length>0&&($("#hdIdPrimary").val(e[0].tm_idrutinasocio),$("#txtImcActual").val(e[0].tm_imc_actual),$("#txtImcMeta").val(e[0].tm_imc_meta),$("#txtFechaInicio").val(ConvertMySQLDate(e[0].tm_fechaInicial)),$("#txtFechaFinal").val(ConvertMySQLDate(e[0].tm_fechaFinal)),Materialize.updateTextFields(),ListarDetalle(e[0].tm_idrutinasocio)),precargaExp(t,!1)},error:function(e){console.log(e)}})})}function addItemDetalle(e){var t="",a=e.td_idrutinadetallesocio,i=e.td_observaciones,n=e.td_serie,l=e.td_repeticion,o=e.td_peso;return t+='<tr data-iditem="'+a+'" class="dato">',t+='<td class="hide">',t+='<input name="itemdetalle['+filaItem+'][iddetalle]" type="hidden" id="iddetalle'+filaItem+'" value="'+a+'" />',t+='<input name="itemdetalle['+filaItem+'][idzonacorporal]" type="hidden" id="idzonacorporal'+filaItem+'" value="'+e.tm_idzonacorporal+'" />',t+='<input name="itemdetalle['+filaItem+'][idequipo]" type="hidden" id="idequipo'+filaItem+'" value="'+e.tm_idequipo+'" />',t+='<input name="itemdetalle['+filaItem+'][observaciones]" type="hidden" id="observaciones'+filaItem+'" value="'+i+'" />',t+='<input name="itemdetalle['+filaItem+'][serie]" type="hidden" id="serie'+filaItem+'" value="'+n+'" />',t+='<input name="itemdetalle['+filaItem+'][repeticion]" type="hidden" id="repeticion'+filaItem+'" value="'+l+'" />',t+='<input name="itemdetalle['+filaItem+'][peso]" type="hidden" id="peso'+filaItem+'" value="'+o+'" /></td>',t+='<td data-title="Descripci&oacute;n " class="v-align-middle nombre-articulo">',t+="<strong>Zona:</strong> "+e.zonacorporal+" - <strong>Equipo:</strong> "+e.equipo+"<br />",t+="<strong>Detalle:</strong> "+i,t+="</td>",t+='<td data-title="Series" class="text-right">'+n+"</td>",t+='<td data-title="Repeticiones" class="text-right">'+l+"</td>",t+='<td data-title="Peso" class="text-right">'+o+"</td>",t+='<td><a class="padding5 mdl-button mdl-button--icon tooltipped center-block" href="#" data-action="delete" data-placement="left" data-toggle="tooltip" title="Eliminar"><i class="material-icons">&#xE872;</i></a></td>',t+="</tr>",++filaItem,t}function Guardar(){var e=new FormData,t=$("#pnlForm :input").serializeArray();e.append("btnGuardar","btnGuardar"),e.append("hdIdEmpresa",$("#hdIdEmpresa").val()),e.append("hdIdCentro",$("#hdIdCentro").val()),e.append("hdIdCliente",getParameterByName("idcliente")),Array.prototype.forEach.call(t,function(t){e.append(t.name,t.value)}),$.ajax({type:"POST",url:"services/rutinacliente/rutinacliente-post.php",cache:!1,contentType:!1,processData:!1,dataType:"json",data:e,success:function(e){createSnackbar(e.titulomsje),"0"!=e.rpta&&(closeCustomModal("#pnlForm"),BuscarDatos("1"))},error:function(e){console.log(e)}})}function BuscarDatos(e){var t="#gvDatos",a=t+" .gridview-content";precargaExp("#pnlListado",!0),$.ajax({type:"GET",url:"services/rutinacliente/rutinacliente-search.php",cache:!1,dataType:"json",data:{tipobusqueda:"1",criterio:$("#txtSearch").val(),idempresa:$("#hdIdEmpresa").val(),idcentro:$("#hdIdCentro").val(),idcliente:getParameterByName("idcliente"),pagina:e},success:function(i){var n=i.length,l=0,o="";if(n>0){for(;l<n;){var c=i[l].tm_idrutinasocio;o+='<li class="collection-item avatar no-border dato" data-idmodel="'+c+'"  data-baselement="'+t+'">',o+='<input name="chkItem[]" type="checkbox" class="oculto" value="'+c+'" />',o+='<i class="icon-select material-icons circle white-text">done</i><div class="layer-select"></div>',o+='<span class="title descripcion"> OBJETIVO : '+i[l].tm_objetivo+"</span>",o+="<p> INC ACTUAL "+i[l].tm_imc_actual+' - IMC META: <span class=" imc_meta">'+i[l].tm_imc_meta+"</span><br>",o+='<span class="correo">Fecha Inicial: '+i[l].tm_fechaInicial+"</span> -  Fecha Final: "+i[l].tm_fechaFinal+"</p>",o+='<div class="grouped-buttons place-top-right padding5">',o+='<a class="padding5 mdl-button mdl-button--icon tooltipped" href="#" data-action="more" data-delay="50" data-position="bottom" data-tooltip="M&aacute;s"><i class="material-icons md-18">&#xE5D4;</i></a>',o+='<ul class="dropdown"><li><a href="#" data-action="edit" class="waves-effect">Editar</a></li><li><a href="#" data-action="delete" class="waves-effect">Eliminar</a></li></ul>',o+="</div>",o+='<div class="divider"></div>',o+="</li>",++l}"1"==e?$(a).html(o):$(a).append(o)}else"1"==e&&$(a).html("<h2>No se encontraron resultados.</h2>");precargaExp("#pnlListado",!1)},error:function(e){console.log(e)}})}function EliminarRutina(){indexList=0,elemsSelected=$("#gvDatos .selected"),eliminarRutina(elemsSelected[0],"multiple")}function eliminarRutina(e,t){var a=new FormData,i=e.getAttribute("data-idmodel");a.append("btnEliminar","btnEliminar"),a.append("hdIdrutinacliente",i),$.ajax({url:"services/rutinacliente/rutinacliente-post.php",type:"POST",dataType:"json",data:a,cache:!1,contentType:!1,processData:!1,success:function(a){var i="",n=!1;"0"==a.rpta?(n=!0,i="No se puede eliminar"):($(e).fadeOut(400,function(){$(this).remove()}),"multiple"==t?(++indexList,indexList<=elemsSelected.length-1?eliminarRutina(elemsSelected[indexList],t):(n=!0,i=a.titulomsje)):"single"==t&&(n=!0,i=a.titulomsje)),n&&(createSnackbar(i),$(".actionbar").hasClass("is-visible")&&$(".back-button").trigger("click"))},error:function(e){console.log(e)}})}function ListarDetalle(e){$.ajax({type:"GET",url:"services/rutinacliente/rutinacliente-detalle-search.php",cache:!1,dataType:"json",data:{tipobusqueda:"5",id:e,pagina:"1"},success:function(e){var t=e.length,a=0,i="";if(t>0)for(;a<t;)i+=addItemDetalle(e[a]),++a;$("#gvArticuloMenu tbody").html(i)},error:function(e){console.log(e)}})}$(function(){BuscarDatos("1"),$(".datepicker").pickadate({format:"dd/mm/yyyy",selectMonths:!0,selectYears:15,today:"Today",clear:"Clear",close:"Ok",closeOnSelect:!1}),$("#btnNuevo").on("click",function(e){e.preventDefault(),GoToEdit("0")}),$("#btnNuevoDetalle").on("click",function(e){e.preventDefault(),openModalCallBack("#pnlRegisterItemDetalle",function(){})}),$("#btnAgregar").on("click",function(e){e.preventDefault();var t={td_idrutinadetallesocio:"0",tm_idzonacorporal:$("#ddlZonaCorporal").val(),zonacorporal:$("#ddlZonaCorporal option:selected").text(),tm_idequipo:$("#ddlEquipo").val(),equipo:$("#ddlEquipo option:selected").text(),td_observaciones:$("#txtDetalle").val(),td_serie:$("#txtSeries").val(),td_repeticion:$("#txtRepeticiones").val(),td_peso:$("#txtPeso").val()},a=addItemDetalle(t);$("#gvArticuloMenu tbody").append(a),closeCustomModal("#pnlRegisterItemDetalle"),LimpiarFormDetalle()}),$("#gvArticuloMenu").on("click","a",function(e){e.preventDefault(),"delete"==this.getAttribute("data-action")&&eliminarElemento(this)}),$("#btnGuardar").on("click",function(e){e.preventDefault(),Guardar()}),$("#gvDatos").on("click touchend",".dropdown a",function(e){e.preventDefault();var t=this.getAttribute("data-action"),a=getParentsUntil(this,"#gvDatos",".dato"),i=a[0].getAttribute("data-idmodel");"edit"==t?GoToEdit(i):"delete"==t&&MessageBox({content:"¿Desea eliminar este elemento?",width:"320px",height:"130px",buttons:[{primary:!0,content:"Eliminar",onClickButton:function(e){eliminarRutina(a[0],"single")}}],cancelButton:!0})})});var filaItem=0;