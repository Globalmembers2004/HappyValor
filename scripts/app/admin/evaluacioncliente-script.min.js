function LimpiarForm(){$("#txtImcActual").val("0"),$("#txtImcMeta").val("0"),$("#txtFechaInicio").val(moment().format("DD/MM/YYYY")),$("#txtFechaFinal").val(moment().format("DD/MM/YYYY")),$("#gvEvaluacion tbody").html("")}function LimpiarFormDetalle(){$("#txtDetalle").val(""),$("#ddlZonaCorporal")[0].selectedIndex=0,$("#ddlEquipo")[0].selectedIndex=0,$("#txtSeries").val("0"),$("#txtRepeticiones").val("0"),$("#txtPeso").val("0")}function eliminarElemento(e){var a=getParentsUntil(e,"#gvEvaluacion",".dato");MessageBox({content:"¿Desea quitar este item?",width:"320px",height:"130px",buttons:[{primary:!0,content:"Quitar item",onClickButton:function(e){$(a[0]).remove()}}],cancelButton:!0})}function GoToEdit(e){var a="#pnlForm";document.getElementById("hdIdPrimary").value="0",precargaExp(a,!0),LimpiarForm(),openModalCallBack(a,function(){"0"==e?precargaExp(a,!1):$.ajax({type:"GET",url:"services/evaluacioncliente/evaluacioncliente-getdetails.php",cache:!1,dataType:"json",data:"id="+e,success:function(e){e.length>0&&($("#hdIdPrimary").val(e[0].tm_idevaluacion),$("#txtAltura").val(e[0].tm_altura),$("#txtPeso").val(e[0].tm_peso),$("#txtImc").val(e[0].tm_imc),$("#txtPorcentajeGrasa").val(e[0].tm_grasa),$("#txtObservacion_Cabecera").val(e[0].tm_observaciones),Materialize.updateTextFields(),ListarDetalle(e[0].tm_idevaluacion)),precargaExp(a,!1)},error:function(e){console.log(e)}})})}function addItemDetalle(e){var a="",t=e.td_idevaluacion,i=(e.tm_idzonacorporal,e.tm_observaciones),l=e.tm_medida;return a+='<tr data-iditem="'+t+'" class="dato">',a+='<td class="hide">',a+='<input name="itemdetalle['+filaItem+'][iddetalle]" type="hidden" id="iddetalle'+filaItem+'" value="'+t+'" />',a+='<input name="itemdetalle['+filaItem+'][idzonacorporal]" type="hidden" id="idzonacorporal'+filaItem+'" value="'+e.tm_idzonacorporal+'" />',a+='<input name="itemdetalle['+filaItem+'][observaciones]" type="hidden" id="observaciones'+filaItem+'" value="'+i+'" />',a+='<input name="itemdetalle['+filaItem+'][medida]" type="hidden" id="medida'+filaItem+'" value="'+l+'" />',a+='<td data-title="Descripci&oacute;n" class="v-align-middle nombre-articulo">'+e.zonacorporal+"</td>",a+='<td data-title="Observaci&oacute;n">'+i+"</td>",a+='<td data-title="Medida" class="text-right">'+l+"</td>",a+='<td><a class="padding5 mdl-button mdl-button--icon tooltipped center-block" href="#" data-action="delete" data-placement="left" data-toggle="tooltip" title="Eliminar"><i class="material-icons">&#xE872;</i></a></td>',a+="</tr>",++filaItem,a}function Guardar(){var e=new FormData,a=$("#pnlForm :input").serializeArray();e.append("btnGuardar","btnGuardar"),e.append("hdIdEmpresa",$("#hdIdEmpresa").val()),e.append("hdIdCentro",$("#hdIdCentro").val()),e.append("hdIdCliente",getParameterByName("idcliente")),Array.prototype.forEach.call(a,function(a){e.append(a.name,a.value)}),$.ajax({type:"POST",url:"services/evaluacioncliente/evaluacioncliente-post.php",cache:!1,contentType:!1,processData:!1,dataType:"json",data:e,success:function(e){createSnackbar(e.titulomsje),"0"!=e.rpta&&(closeCustomModal("#pnlForm"),BuscarDatos("1"))},error:function(e){console.log(e)}})}function BuscarDatos(e){var a="#gvDatos",t=a+" .gridview-content";precargaExp("#pnlListado",!0),$.ajax({type:"GET",url:"services/evaluacioncliente/evaluacioncliente-search.php",cache:!1,dataType:"json",data:{criterio:$("#txtSearch").val(),idempresa:$("#hdIdEmpresa").val(),idcentro:$("#hdIdCentro").val(),idcliente:getParameterByName("idcliente"),pagina:e},success:function(i){var l=i.length,n=0,o="";if(l>0){for(;n<l;){var c=i[n].tm_idevaluacion;o+='<li class="collection-item avatar no-border dato" data-idmodel="'+c+'"  data-baselement="'+a+'">',o+='<input name="chkItem[]" type="checkbox" class="oculto" value="'+c+'" />',o+='<i class="icon-select material-icons circle white-text">done</i><div class="layer-select"></div>',o+='<span class="title descripcion"> OBJETIVO : '+i[n].tm_observaciones+"</span>",o+="<p> ALTURA: "+i[n].tm_altura+' - PESO : <span class=" peso">'+i[n].tm_peso+"</span><br>",o+='<span class="correo">IMC: '+i[n].tm_imc+"</span> -  % de grasa: "+i[n].tm_grasa+"</p>",o+='<div class="grouped-buttons place-top-right padding5">',o+='<a class="padding5 mdl-button mdl-button--icon tooltipped" href="#" data-action="more" data-delay="50" data-position="bottom" data-tooltip="M&aacute;s"><i class="material-icons md-18">&#xE5D4;</i></a>',o+='<ul class="dropdown"><li><a href="#" data-action="edit" class="waves-effect">Editar</a></li><li><a href="#" data-action="delete" class="waves-effect">Eliminar</a></li></ul>',o+="</div>",o+='<div class="divider"></div>',o+="</li>",++n}"1"==e?$(t).html(o):$(t).append(o)}else"1"==e&&$(t).html("<h2>No se encontraron resultados.</h2>");precargaExp("#pnlListado",!1)},error:function(e){console.log(e)}})}function EliminarEvaluacion(){indexList=0,elemsSelected=$("#gvDatos .selected"),eliminarEvaluacion(elemsSelected[0],"multiple")}function eliminarEvaluacion(e,a){var t=new FormData,i=e.getAttribute("data-idmodel");t.append("btnEliminar","btnEliminar"),t.append("hdIdevaluacioncliente",i),$.ajax({url:"services/evaluacioncliente/evaluacioncliente-post.php",type:"POST",dataType:"json",data:t,cache:!1,contentType:!1,processData:!1,success:function(t){var i="",l=!1;"0"==t.rpta?(l=!0,i="No se puede eliminar"):($(e).fadeOut(400,function(){$(this).remove()}),"multiple"==a?(++indexList,indexList<=elemsSelected.length-1?eliminarEvaluacion(elemsSelected[indexList],a):(l=!0,i=t.titulomsje)):"single"==a&&(l=!0,i=t.titulomsje)),l&&(createSnackbar(i),$(".actionbar").hasClass("is-visible")&&$(".back-button").trigger("click"))},error:function(e){console.log(e)}})}function ListarDetalle(e){$.ajax({type:"GET",url:"services/evaluacioncliente/evaluacioncliente-detalle-search.php",cache:!1,dataType:"json",data:{tipobusqueda:"5",id:e,pagina:"1"},success:function(e){var a=e.length,t=0,i="";if(a>0)for(;t<a;)i+=addItemDetalle(e[t]),++t;$("#gvEvaluacion tbody").html(i)},error:function(e){console.log(e)}})}$(function(){BuscarDatos("1"),$(".datepicker").pickadate({format:"dd/mm/yyyy",selectMonths:!0,selectYears:15,today:"Today",clear:"Clear",close:"Ok",closeOnSelect:!1}),$("#btnNuevo").on("click",function(e){e.preventDefault(),GoToEdit("0")}),$("#btnNuevoDetalle").on("click",function(e){e.preventDefault(),openModalCallBack("#pnlRegisterItemDetalle",function(){})}),$("#btnAgregar").on("click",function(e){e.preventDefault();var a={td_idevaluacion:"0",tm_idzonacorporal:$("#ddlZonaCorporal").val(),zonacorporal:$("#ddlZonaCorporal option:selected").text(),tm_medida:$("#txtMedida").val(),tm_observaciones:$("#txtObservacion_Detalle").val()},t=addItemDetalle(a);$("#gvEvaluacion tbody").append(t),closeCustomModal("#pnlRegisterItemDetalle"),LimpiarFormDetalle()}),$("#gvEvaluacion").on("click","a",function(e){e.preventDefault(),"delete"==this.getAttribute("data-action")&&eliminarElemento(this)}),$("#btnGuardar").on("click",function(e){e.preventDefault(),Guardar()}),$("#gvDatos").on("click touchend",".dropdown a",function(e){e.preventDefault();var a=this.getAttribute("data-action"),t=getParentsUntil(this,"#gvDatos",".dato"),i=t[0].getAttribute("data-idmodel");"edit"==a?GoToEdit(i):"delete"==a&&MessageBox({content:"¿Desea eliminar este elemento?",width:"320px",height:"130px",buttons:[{primary:!0,content:"Eliminar",onClickButton:function(e){eliminarEvaluacion(t[0],"single")}}],cancelButton:!0})})});var filaItem=0;